input {
  lumberjack {
    port => 5000
    ssl_certificate => "/etc/logstash/ssl/lumberjack.crt"
    ssl_key => "/etc/logstash/ssl/lumberjack.key" 
  }
}
filter {
   if [type] == "cloudera-server" {
    grok {
      match => { "message" => "%{DATA:timestamp} %{WORD:severity} %{DATA:topic}: %{GREEDYDATA:logmessage}" }
    }
  }
  if [type] == "cloudera-agent" {
    grok {
      match => { "message" => "\[(?<timestamp>.*).\+.....\s+\d+\s+(?<header>.*)\s+(?<severity>ERROR|INFO|OFF|FATAL|WARN|DEBUG|TRACE)\s+(?<logmessage>.*)"}
    }
  }
  if "_grokparsefailure" in [tags] { drop {} } 
}
output { 
  elasticsearch {
    host => localhost
    protocol => http
    index => "test"
    cluster => "elasticsearch"
  } 
}
